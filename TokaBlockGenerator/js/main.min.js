var isChanged=!1,format_version="1.16.100",is_separator_drag=!1,timeoutID,is_can_issue=!0,help_page_num=0,format_json=new Object;function switchHelp(){switch(help_page_num){case 1:return $("#help-content-1").fadeOut("fast"),$("#help-content-2").slideToggle("fast"),void help_page_num++;case 2:return $("#help-content-2").slideToggle("fast"),$("#help-content-3").fadeIn("fast"),void help_page_num++;case 3:return $("#help-content-3").fadeOut("fast"),$("#page-help").hide(),void(help_page_num=0);case 5:return $("#help-content-1").hide(),$("#help-content-2").hide(),$("#help-content-3").hide(),$("#page-help").hide(),void(help_page_num=0);case 0:default:return $("#help-content-1").fadeIn("fast"),void help_page_num++}}function importJsonFile(){const data=$("#input-file").prop("files")[0],file_reader=new FileReader;file_reader.onload=function(){const json_text=file_reader.result;setJSONData(json_text)};try{file_reader.readAsText(data)}catch(e){console.error("error:"+e)}}function setFormatJson(){let request=new XMLHttpRequest;request.open("GET","../json/format.json"),request.responseType="json",request.send(),request.onload=function(){format_json=new Object(request.response)}}function onChangedJSON(){onChangedFlammable(),is_can_issue&&checkIssue(),setDelayIssue();const json_code=getJSONData();$("pre.language-json code.language-json").remove(),$("pre.language-json").append($("<code>").addClass("language-json").text(json_code)),$("textarea#code-buffer").val(json_code),Prism.highlightAll()}function setDelayIssue(){is_can_issue=!1,"number"==typeof timeoutID&&window.clearTimeout(timeoutID),timeoutID=window.setTimeout((function(){is_can_issue=!0,checkIssue()}),500)}function onChangedFlammable(){const flame_odds=$(".components-flammable-flame-odds"),flame_odds_len=flame_odds.length,burn_odds=$(".components-flammable-burn-odds");for(let index=0;index<flame_odds_len;index++){const is_empty="0"==flame_odds.eq(index).val();burn_odds.eq(index).prop("disabled",is_empty),burn_odds.eq(index).closest(".value-element").toggleClass("disabled",is_empty)}}function checkIssue(){$("ul.issue-list li").remove(),$(".stat-warning,.stat-error").removeClass("stat-warning stat-error");const error_num=checkJSONError(),warning_num=checkJSONWarning();$("span.issue-warning-num").text("警告:"+warning_num),$("span.issue-error-num").text("エラー:"+error_num),warning_num<=0&&error_num<=0&&$("ul.issue-list").append("<li>問題はありません</li>")}function addIssue(type,issue_comment,issue_element){let content=$("<li>");"warning"==type?(content.append($("<img>").attr({src:"img/warning.svg",alt:"",width:"19px",height:"19px"}),$("<p>").text(issue_comment)),issue_element.addClass("stat-warning")):"error"==type&&(content.append($("<img>").attr({src:"img/error.svg",alt:"",width:"19px",height:"19px"}),$("<p>").text(issue_comment)),issue_element.addClass("stat-error")),$("ul.issue-list").append(content)}function checkJSONWarning(){let warning_num=0;return 0}function checkJSONError(){let error_num=0;const block_name=$("#description-block-name"),block_ID=block_name.val().split(/:/);let message="";return block_ID.length<2?message='[Description:identifier] ブロックIDが ":" で区切られていません。"名前空間:ブロックID"の形式になっている必要があります。':block_ID.length>2?message='[Description:identifier] 不明なID形式です。"名前空間:ブロックID"の形式になっている必要があります。':""==block_ID[1]?message='[Description:identifier] ブロックIDが空です。ブロックIDを入力してください。ブロックIDは"名前空間:ブロックID"を入力してください。':""==block_ID[0]&&(message='[Description:identifier] 名前空間が空です。名前空間を入力してください。ブロックIDは"名前空間:ブロックID"を入力してください。'),""!=message&&(addIssue("error",message,block_name),error_num++),error_num}function getJSONData(){let json_raw={};json_raw.format_version=format_version,json_raw["minecraft:block"]=new Object;let description=new Object;switch(description.identifier=$("#description-block-name").val(),format_version){case"1.16.100":const status_block_contents=$(".blockState.status-block-content"),status_block_contents_len=status_block_contents.length,name_list=$("#blockState-name-list");if(name_list.children().remove(),(()=>{for(let index=0;index<status_block_contents_len;index++)if(""!=$(".blockState-name").eq(index).val())return!0;return!1})()){let properties=new Object;for(let index=0;index<status_block_contents_len;index++){const body=status_block_contents.eq(index),key=body.find(".blockState-name").val();if(""!=key){const type=body.find(".blockState-type").val();let data_list=new Array;switch(type){case"val_Integer":{const array_data=body.find(`.${type}>.value-element input.blockState-integer.type-array-integer`),array_data_len=array_data.length;for(let num=0;num<array_data_len;num++)""!=array_data.eq(num).val()&&data_list.push(Number(array_data.eq(num).val())),console.log(data_list)}break;case"val_String":{const array_data=body.find(`.${type}>.value-element input.blockState-string.type-array-string`),array_data_len=array_data.length;for(let num=0;num<array_data_len;num++)""!=array_data.eq(num).val()&&data_list.push(array_data.eq(num).val())}break;case"val_Boolean":default:const bool=body.find(".blockState-boolean").is(":checked");data_list=[bool,!bool]}properties[key]=data_list,name_list.append($("<option>").attr("value",key))}}description.properties=properties}break;case"1.16.0":case"1.12.0":description.is_experimental=$("#description-is-experimental").is(":checked"),description["register_to_creative-menu"]=$("#description-register-to-creative-menu").is(":checked")}switch(json_raw["minecraft:block"].description=description,json_raw["minecraft:block"].components=getComponents($("#editor-main .editor-element-body").children(),format_version),format_version){case"1.16.100":const status_block_contents=$(".event.status-block-content"),status_block_contents_len=status_block_contents.length,name_list=$("#event-name-list");if(name_list.children().remove(),(()=>{for(let index=0;index<status_block_contents_len;index++)if(""!=$(".event-name").eq(index).val())return!0;return!1})()){let events=new Object;for(let index=0;index<status_block_contents_len;index++){const body=status_block_contents.eq(index),key=body.find(".event-name").val();if(""!=key){const value_element=body.children(".editor-element").children(".editor-element-body").children();events[key]=getEventResponses(value_element),name_list.append($("<option>").attr("value",key))}}json_raw["minecraft:block"].events=events}}switch(format_version){case"1.16.100":const conditions=$(".permutations_condition"),conditions_len=conditions.length;if((()=>{for(let index=0;index<conditions_len;index++)if(""!=conditions.eq(index).val())return!0;return!1})()){let permutations=new Array;const container=$(".permutations.block-tab-container");for(let index=0;index<conditions_len;index++){const body=container.eq(index).find(".editor-element-body"),condition=conditions.eq(index).val();if(""!=condition){let data=new Object;data.condition=condition,data.components=getComponents(body.children(),format_version),permutations.push(data)}}json_raw["minecraft:block"].permutations=permutations}}return JSON.stringify(json_raw,null,"  ")}function getComponents(value_elements,format_version){let components=new Object;switch(format_version){case"1.16.100":let element=value_elements.filter(".components_loot");if(element.length&&(components["minecraft:loot"]=element.find(".components-loot").val()),element=value_elements.filter(".components_display_name"),element.length&&(components["minecraft:display_name"]=element.find(".components-display-name").val()),element=value_elements.filter(".components_tag"),element.length){const tag=element.find(".components-tag"),tag_len=tag.length;for(let index=0;index<tag_len;index++)components[`tag:${tag.eq(index).val()}`]=new Object}if(element=value_elements.filter(".components_placement_filter"),element.length){components["minecraft:placement_filter"]=new Object;const container=element.find(".tab-container"),container_len=container.length;let condition_list=new Array;for(let index=0;index<container_len;index++){let condition=new Object;const face=container.eq(index).find(".components-placement-filter-allowed_faces");let allowed_faces=new Array;for(let index_face=0;index_face<face.length&&index_face<=8;index_face++)allowed_faces.push(face.eq(index_face).val());condition.allowed_faces=allowed_faces;const block=container.eq(index).find(".components-placement-filter-block-filter");let block_filter=new Array;for(let index_block=0;index_block<block.length;index_block++)block_filter.push(block.eq(index_block).val());condition.block_filter=block_filter,condition_list.push(condition)}components["minecraft:placement_filter"].conditions=condition_list}if(element=value_elements.filter(".components_preventsjumping"),element.length&&(components["minecraft:preventsjumping"]=element.find(".components-preventsJumping").is(":checked")),element=value_elements.filter(".components_unwalkable"),element.length&&(components["minecraft:unwalkable"]=element.find(".components-unwalkable").is(":checked")),element=value_elements.filter(".components_map_color"),element.length&&(components["minecraft:map_color"]=element.find(".components-map-color").val()),element=value_elements.filter(".components_crafting_table"),element.length){let crafting_table=new Object;crafting_table.grid_size=Number(element.find(".components-crafting-table-grid-size").val());const tag=element.find(".components-crafting-table-crafting-tags"),tag_len=tag.length;let crafting_tags=new Array;for(let index=0;index<tag_len;index++)crafting_tags.push(tag.eq(index).val());crafting_table.crafting_tags=crafting_tags,crafting_table.custom_description=element.find(".components-crafting-table-custom-description").val(),components["minecraft:crafting_table"]=crafting_table}if(element=value_elements.filter(".components_geometry"),element.length)switch(element.find(".components-geometry-switch").val()){case"val_geometry":components["minecraft:geometry"]=element.find(".components-geometry").val();break;case"val_cube":components["minecraft:unit_cube"]=new Object}if(element=value_elements.filter(".components_material_instances"),element.length){let data=new Object;const face=element.find(".components-material-instances-face"),face_len=face.length;for(let index=0;index<face_len;index++){let instance=new Object;instance.texture=element.find(".components-material-instances-texture").eq(index).val(),instance.render_method=element.find(".components-material-instances-material").eq(index).val(),data[face.eq(index).val()]=instance}components["minecraft:material_instances"]=data}if(element=value_elements.filter(".components_entity_collision"),element.length){let val;switch(element.find(".components-entity-collision-switch").val()){case"val_simple":val=element.find(".components-entity-collision-simple").is(":checked");break;case"val_details":val=new Object,val.origin=[Number(element.find(".components-entity-collision-origin-x").val()),Number(element.find(".components-entity-collision-origin-y").val()),Number(element.find(".components-entity-collision-origin-z").val())],val.size=[Number(element.find(".components-entity-collision-size-x").val()),Number(element.find(".components-entity-collision-size-y").val()),Number(element.find(".components-entity-collision-size-z").val())]}components["minecraft:entity_collision"]=val}if(element=value_elements.filter(".components_pick_collision"),element.length){let val;switch(element.find(".components-pick-collision-switch").val()){case"val_simple":val=element.find(".components-pick-collision-simple").is(":checked");break;case"val_details":val=new Object,val.origin=[Number(element.find(".components-pick-collision-origin-x").val()),Number(element.find(".components-pick-collision-origin-y").val()),Number(element.find(".components-pick-collision-origin-z").val())],val.size=[Number(element.find(".components-pick-collision-size-x").val()),Number(element.find(".components-pick-collision-size-y").val()),Number(element.find(".components-pick-collision-size-z").val())]}components["minecraft:pick_collision"]=val}if(element=value_elements.filter(".components_rotation"),element.length&&(components["minecraft:rotation"]=[parseInt(element.find(".components-rotation-x").val()),parseInt(element.find(".components-rotation-y").val()),parseInt(element.find(".components-rotation-z").val())]),element=value_elements.filter(".components_breathability"),element.length&&(components["minecraft:breathability"]=element.find(".components-breathability").val()),element=value_elements.filter(".components_block_light_absorption"),element.length&&(components["minecraft:block_light_absorption"]=parseInt(element.find(".components-block-light-absorption").val())),element=value_elements.filter(".components_block_light_emission"),element.length&&(components["minecraft:block_light_emission"]=Number(element.find(".components-block-light-emission").val())),element=value_elements.filter(".components_destroy_time"),element.length&&(components["minecraft:destroy_time"]=Number(element.find(".components-destroy-time").val())),element=value_elements.filter(".components_explosion_resistance"),element.length&&(components["minecraft:explosion_resistance"]=Number(element.find(".components-explosion-resistance").val())),element=value_elements.filter(".components_breakonpush"),element.length&&(components["minecraft:breakonpush"]=element.find(".components-breakonpush").is(":checked")),element=value_elements.filter(".components_immovable"),element.length&&(components["minecraft:immovable"]=element.find(".components-immovable").is(":checked")),element=value_elements.filter(".components_onlypistonpush"),element.length&&(components["minecraft:onlypistonpush"]=element.find(".components-onlypistonpush").is(":checked")),element=value_elements.filter(".components_friction"),element.length&&(components["minecraft:friction"]=Number(element.find(".components-friction").val())),element=value_elements.filter(".components_flammable"),element.length){let flammable=new Object;flammable.flame_odds=parseInt(element.find(".components-flammable-flame-odds").val()),flammable.burn_odds=parseInt(element.find(".components-flammable-burn-odds").val()),components["minecraft:flammable"]=flammable}if(element=value_elements.filter(".components_event_on_fall_on"),element.length){let content=new Object;content.event=element.find(".components-event-on-fall-on-event").val();let val=element.find(".components-event-on-fall-on-condition").val();""!=val&&(content.condition=val),val=element.find(".components-event-on-fall-on-target").val(),"default"!=val&&(content.target=val),components["minecraft:on_fall_on"]=content}if(element=value_elements.filter(".components_event_on_interact"),element.length){let content=new Object;content.event=element.find(".components-event-on-interact-event").val();let val=element.find(".components-event-on-interact-condition").val();""!=val&&(content.condition=val),val=element.find(".components-event-on-interact-target").val(),"default"!=val&&(content.target=val),components["minecraft:on_interact"]=content}if(element=value_elements.filter(".components_event_on_placed"),element.length){let content=new Object;content.event=element.find(".components-event-on-placed-event").val(),content.condition=element.find(".components-event-on-placed-condition").val();let val=element.find(".components-event-on-placed-target").val();"default"!=val&&(content.target=val),components["minecraft:on_placed"]=content}if(element=value_elements.filter(".components_event_on_player_placing"),element.length){let content=new Object;content.event=element.find(".components-event-on-player-placing-event").val();let val=element.find(".components-event-on-player-placing-condition").val();""!=val&&(content.condition=val),val=element.find(".components-event-on-player-placing-target").val(),"default"!=val&&(content.target=val),components["minecraft:on_player_placing"]=content}if(element=value_elements.filter(".components_event_on_step_on"),element.length){let content=new Object;content.event=element.find(".components-event-on-step-on-event").val();let val=element.find(".components-event-on-step-on-condition").val();""!=val&&(content.condition=val),val=element.find(".components-event-on-step-on-target").val(),"default"!=val&&(content.target=val),components["minecraft:on_step_on"]=content}if(element=value_elements.filter(".components_event_on_step_off"),element.length){let content=new Object;content.event=element.find(".components-event-on-step-off-event").val();let val=element.find(".components-event-on-step-off-condition").val();""!=val&&(content.condition=val),val=element.find(".components-event-on-step-off-target").val(),"default"!=val&&(content.target=val),components["minecraft:on_step_off"]=content}if(element=value_elements.filter(".components_event_on_player_destroyed"),element.length){let content=new Object;content.event=element.find(".components-event-on-player-destroyed-event").val();let val=element.find(".components-event-on-player-destroyed-condition").val();""!=val&&(content.condition=val),val=element.find(".components-event-on-player-destroyed-target").val(),"default"!=val&&(content.target=val),components["minecraft:on_player_destroyed"]=content}if(element=value_elements.filter(".components_event_ticking"),element.length){components["minecraft:ticking"]=new Object;let content=new Object;content.event=element.find(".components-event-ticking-event").val();let val=element.find(".components-event-ticking-condition").val();""!=val&&(content.condition=val),val=element.find(".components-event-ticking-target").val(),"default"!=val&&(content.target=val),components["minecraft:ticking"].on_tick=content,components["minecraft:ticking"].range=[Number(element.find(".components-event-ticking-range-x").val()),Number(element.find(".components-event-ticking-range-z").val())],components["minecraft:ticking"].looping=element.find(".components-event-ticking-looping").is(":checked")}if(element=value_elements.filter(".components_event_random_ticking"),element.length){components["minecraft:random_ticking"]=new Object;let content=new Object;content.event=element.find(".components-event-random-ticking-event").val();let val=element.find(".components-event-random-ticking-condition").val();""!=val&&(content.condition=val),val=element.find(".components-event-random-ticking-target").val(),"default"!=val&&(content.target=val),components["minecraft:random_ticking"].on_tick=content}break;case"1.16.0":if(element=value_elements.filter(".components_loot"),element.length&&(components["minecraft:loot"]=element.find(".components-loot").val()),element=value_elements.filter(".components_destroy_time"),element.length&&(components["minecraft:destroy_time"]=Number(element.find(".components-destroy-time").val())),element=value_elements.filter(".components_explosion_resistance"),element.length&&(components["minecraft:explosion_resistance"]=Number(element.find(".components-explosion-resistance").val())),element=value_elements.filter(".components_friction"),element.length&&(components["minecraft:friction"]=Number(element.find(".components-friction").val())),element=value_elements.filter(".components_flammable"),element.length){let flammable=new Object;flammable.flame_odds=parseInt(element.find(".components-flammable-flame-odds").val()),flammable.burn_odds=parseInt(element.find(".components-flammable-burn-odds").val()),components["minecraft:flammable"]=flammable}element=value_elements.filter(".components_map_color"),element.length&&(components["minecraft:map_color"]=element.find(".components-map-color").val()),element=value_elements.filter(".components_block_light_absorption"),element.length&&(components["minecraft:block_light_absorption"]=parseInt(element.find(".components-block-light-absorption").val())),element=value_elements.filter(".components_block_light_emission"),element.length&&(components["minecraft:block_light_emission"]=Number(element.find(".components-block-light-emission").val()));break;case"1.12.0":element=value_elements.filter(".components_loot"),element.length&&(components["minecraft:loot"]=new Object,components["minecraft:loot"].table=element.find(".components-loot").val()),element=value_elements.filter(".components_destroy_time"),element.length&&(components["minecraft:destroy_time"]=new Object,components["minecraft:destroy_time"].value=Number(element.find(".components-destroy-time").val())),element=value_elements.filter(".components_explosion_resistance"),element.length&&(components["minecraft:explosion_resistance"]=new Object,components["minecraft:explosion_resistance"].value=Number(element.find(".components-explosion-resistance").val())),element=value_elements.filter(".components_friction"),element.length&&(components["minecraft:friction"]=new Object,components["minecraft:friction"].value=Number(element.find(".components-friction").val())),element=value_elements.filter(".components_flammable"),element.length&&(components["minecraft:flammable"]=new Object,components["minecraft:flammable"].flame_odds=parseInt(element.find(".components-flammable-flame-odds").val()),components["minecraft:flammable"].burn_odds=parseInt(element.find(".components-flammable-burn-odds").val())),element=value_elements.filter(".components_map_color"),element.length&&(components["minecraft:map_color"]=new Object,components["minecraft:map_color"].color=element.find(".components-map-color").val()),element=value_elements.filter(".components_block_light_absorption"),element.length&&(components["minecraft:block_light_absorption"]=new Object,components["minecraft:block_light_absorption"].value=parseInt(element.find(".components-block-light-absorption").val())),element=value_elements.filter(".components_block_light_emission"),element.length&&(components["minecraft:block_light_emission"]=new Object,components["minecraft:block_light_emission"].emission=Number(element.find(".components-block-light-emission").val()))}return components}function getEventResponses(value_elements){let event_responses=new Object,element=value_elements.filter(".event_responses_set_block_property");if(element.length&&(event_responses.set_block_property=new Object),element=value_elements.filter(".event_responses_set_block_at_pos"),element.length){let responses_name="set_block",content=new Object;"val_position"==element.find(".event-responses-set-block-switch").val()&&(responses_name="set_block_at_pos",content.block_offset=[Number(element.find(".event-responses-set-block-position-x").val()),Number(element.find(".event-responses-set-block-position-y").val()),Number(element.find(".event-responses-set-block-position-z").val())]);try{content.block_type=JSON.parse(`{${element.find(".event-responses-set-block-id").val()}}`)}catch(error){content.block_type=element.find(".event-responses-set-block-id").val()}event_responses[responses_name]=content}if(element=value_elements.filter(".event_responses_spawn_loot"),element.length&&(event_responses.spawn_loot=new Object,event_responses.spawn_loot.table=element.find(".event-responses-spawn-loot").val()),element=value_elements.filter(".event_responses_add_mob_effect"),element.length){let content=new Object;content.effect=element.find(".event-responses-add-mob-effect-id").val(),content.amplifier=Number(element.find(".event-responses-add-mob-effect-amplifier").val()),content.duration=Number(element.find(".event-responses-add-mob-effect-duration").val()),"default"!=element.find(".event-responses-add-mob-effect-target").val()&&(content.target=element.find(".event-responses-add-mob-effect-target").val()),event_responses.add_mob_effect=content}if(element=value_elements.filter(".event_responses_remove_mob_effect"),element.length){let content=new Object;content.effect=element.find(".event-responses-remove-mob-effect-id").val(),"default"!=element.find(".event-responses-remove-mob-effect-target").val()&&(content.target=element.find(".event-responses-remove-mob-effect-target").val()),event_responses.remove_mob_effect=content}if(element=value_elements.filter(".event_responses_damage"),element.length){let content=new Object;content.type=element.find(".event-responses-damage-type").val(),content.amount=element.find(".event-responses-damage-amount").val(),"default"!=element.find(".event-responses-damage-target").val()&&(content.target=element.find(".event-responses-damage-target").val()),event_responses.damage=content}if(element=value_elements.filter(".event_responses_decrement_stack"),element.length){let content=new Object;content.ignore_game_mode=element.find(".event-responses-decrement-stack-ignore-game-mode").is(":checked"),event_responses.decrement_stack=content}if(element=value_elements.filter(".event_responses_die"),element.length){let content=new Object;"default"!=element.find(".event-responses-die-target").val()&&(content.target=element.find(".event-responses-die-target").val()),event_responses.die=content}if(element=value_elements.filter(".event_responses_play_effect"),element.length){let content=new Object;content.effect=element.find(".event-responses-play-effect-id").val(),content.data=element.find(".event-responses-play-effect-data").val(),"default"!=element.find(".event-responses-play-effect-target").val()&&(content.target=element.find(".event-responses-play-effect-target").val()),event_responses.play_effect=content}if(element=value_elements.filter(".event_responses_play_sound"),element.length){let content=new Object;content.sound=element.find(".event-responses-play-sound-id").val(),"default"!=element.find(".event-responses-play-sound-target").val()&&(content.target=element.find(".event-responses-play-sound-target").val()),event_responses.play_sound=content}if(element=value_elements.filter(".event_responses_teleport"),element.length){let content=new Object;content.destination=[Number(element.find(".event-responses-teleport-destination-x").val()),Number(element.find(".event-responses-teleport-destination-y").val()),Number(element.find(".event-responses-teleport-destination-z").val())],content.max_range=[Number(element.find(".event-responses-teleport-max-range-x").val()),Number(element.find(".event-responses-teleport-max-range-y").val()),Number(element.find(".event-responses-teleport-max-range-z").val())],content.avoid_water=element.find(".event-responses-teleport-avoid_water").is(":checked"),content.land_on_block=element.find(".event-responses-teleport-land-on-block").is(":checked"),"default"!=element.find(".event-responses-teleport").val()&&(content.target=element.find(".event-responses-teleport").val()),event_responses.teleport=content}if(element=value_elements.filter(".event_responses_transform_item"),element.length&&(event_responses.transform_item.transform=element.find(".event-responses-transform-item-id").val()),element=value_elements.filter(".event_responses_trigger"),element.length){let content=new Object;content.event=element.find(".event-responses-trigger-event").val();let val=element.find(".event-responses-trigger-condition").val();""!=val&&(content.condition=val),val=element.find(".event-responses-trigger-target").val(),"default"!=val&&(content.target=val),event_responses.trigger=content}if(element=value_elements.filter(".event_responses_run_command"),element.length){let content=new Object;const command=element.find(".event-responses-run-command"),command_len=command.length;let command_array=new Array;for(let index=0;index<command_len;index++){const val=command.eq(index).val();""!=val&&command_array.push(val)}content.command=command_array,"default"!=element.find(".event-responses-run-command-target").val()&&(content.target=element.find(".event-responses-run-command-target").val()),event_responses.run_command=content}if(element=value_elements.filter(".event_responses_swing"),element.length&&(event_responses.swing=new Object),element=value_elements.filter(".event_responses_sequence"),element.length){const container=element.closestOpposite(".tab-contents").children(".tab-container"),container_len=container.length;let content=new Array;for(let index=0;index<container_len;index++)content.push(getEventResponses(container.eq(index).children(".editor-element-body").children()));event_responses.sequence=content}if(element=value_elements.filter(".event_responses_randomize"),element.length){const container=element.closestOpposite(".tab-contents").children(".tab-container"),container_len=container.length;let content=new Array;for(let index=0;index<container_len;index++){let data=getEventResponses(container.eq(index).children(".editor-element-body").children());data.weight=Number(element.find(".event-responses-randomize-weight").val()),content.push(data)}event_responses.randomize=content}return event_responses}function getErrorText(text="",message=""){let messageText="有効なjsonではありません。";if(""==text||""==message)return messageText;const splitText=message.split(" "),lineIndex=splitText.findIndex(element=>"line"==element),positionIndex=splitText.findIndex(element=>"position"==element);if(-1!=lineIndex){const line=parseInt(splitText[lineIndex+1],10),getBeginningOfLineIndex=maxLine=>{let lastIndex=0;for(let i=1;i<maxLine;i++)lastIndex=text.indexOf("\n",lastIndex)+1;return lastIndex},prevLineIndex=getBeginningOfLineIndex(line-1),LineLastIndex=getBeginningOfLineIndex(line+1)-1;messageText+=`\n${line-1}~${line}行で問題が発生しました。\n${text.substring(prevLineIndex,LineLastIndex)}`}else if(-1!=positionIndex){const position=splitText[positionIndex+1],prevLineIndex=text.lastIndexOf("\n",text.lastIndexOf("\n",position)-1)+1,prevLineNum=text.substr(0,prevLineIndex).match(/\n/g).length+1;messageText+=`\n${prevLineNum}~${prevLineNum+1}行で問題が発生しました。\n${text.substring(prevLineIndex,text.indexOf("\n",position-1))}`}return messageText}function setJSONData(json_text=""){let json_data;try{json_data=JSON.parse(json_text)}catch(e){return window.alert(getErrorText(json_text,e.message)),void console.error("error:"+e)}if(null!=(format_version=json_data.format_version))switch(format_version){case"1.16.100":case"1.16.0":case"1.12.0":break;default:const temp=format_version.split(/,/).map(str=>Number(str));temp[0]>=1&&temp[1]>=16&&temp[2]>=100?format_version="1.16.100":1==temp[0]&&16==temp[1]&&temp[2]>=0?format_version="1.16.0":temp[0]<=1&&temp[1]<16&&(format_version="1.12.0")}$("#format-version").val(format_version);const description=json_data["minecraft:block"].description;null!=description.identifier&&$("#description-block-name").val(description.identifier);const components=json_data["minecraft:block"].components;switch(format_version){case"1.16.100":break;case"1.16.0":if(description.is_experimental&&$("#description-is-experimental").prop("checked",!0),description.register_to_creative_menu&&$("#description-register-to-creative-menu").prop("checked",!0),null!=components["minecraft:loot"]&&$("#components-loot").val(components["minecraft:loot"]),null!=components["minecraft:destroy_time"]&&$("#components-destroy-time").val(components["minecraft:destroy_time"]),null!=components["minecraft:explosion_resistance"]&&$("#components-explosion-resistance").val(components["minecraft:explosion_resistance"]),null!=components["minecraft:friction"]&&$("#components-friction").val(components["minecraft:friction"]),null!=components["minecraft:flammable"]){const flammable=components["minecraft:flammable"];$("#components-flame-odds").val(flammable.flame_odds),0!=flammable.flame_odds&&($("#components-burn-odds").val(flammable.burn_odds),$("#components-burn-odds").prop("disabled",!1))}null!=components["minecraft:map_color"]&&($("#components-map-color").val(components["minecraft:map_color"]),$("#components-map-color-pick").val(components["minecraft:map_color"])),null!=components["minecraft:block_light_absorption"]&&$("#components-block-light-absorption").val(components["minecraft:block-light-absorption"]),null!=components["minecraft:block_light_emission"]&&$("#components-block-light-emission").val(components["minecraft:block_light_emission"]);break;case"1.12.0":if(description.is_experimental&&$("#description-is-experimental").prop("checked",!0),description.register_to_creative_menu&&$("#description-register-to-creative-menu").prop("checked",!0),null!=components["minecraft:loot"].table&&$("#components-loot").val(components["minecraft:loot"].table),null!=components["minecraft:destroy_time"].value&&$("#components-destroy-time").val(components["minecraft:destroy_time"].value),null!=components["minecraft:explosion_resistance"].value&&$("#components-explosion-resistance").val(components["minecraft:explosion_resistance"].value),null!=components["minecraft:friction"].value&&$("#components-friction").val(components["minecraft:friction"].value),null!=components["minecraft:flammable"]){const flammable=components["minecraft:flammable"];$("#components-flame-odds").val(flammable.flame_odds),0!=flammable.flame_odds&&($("#components-burn-odds").val(flammable.burn_odds),$("#components-burn-odds").prop("disabled",!1))}null!=components["minecraft:map_color"].color&&($("#components-map-color").val(components["minecraft:map_color"].color),$("#components-map-color-pick").val(components["minecraft:map_color"].color)),null!=components["minecraft:block_light_absorption"].value&&$("#components-block-light-absorption").val(components["minecraft:block_light_absorption"].value),null!=components["minecraft:block_light_emission"].emission&&$("#components-block-light-emission").val(components["minecraft:block_light_emission"].emission)}onChangedJSON()}onChangedJSON(),$(window).bind("beforeunload",(function(){if(isChanged)return"このページを離れようとしています。"})),$(document).on("change","input,textarea,select",(function(){onChangedJSON(),isChanged=!0})),$(document).on("keyup","input,textarea,select",(function(){onChangedJSON(),isChanged=!0})),$(".separator").on("mousedown",(function(e){is_separator_drag?is_separator_drag&&(is_separator_drag=!1):is_separator_drag=!0})),$(document).on("mouseup",(function(){is_separator_drag=!1,$("html").css("cursor","");const separator=$(".separator");separator.prev().removeClass("drag-lock"),separator.next().removeClass("drag-lock")})),$(document).on("mousemove",(function(e){if(is_separator_drag){$("html").css("cursor","e-resize");const separator=$(".separator");separator.prev().addClass("drag-lock"),separator.next().addClass("drag-lock");const maxwidth=$("html").width()-2,next_width=maxwidth-e.clientX,prev_width=maxwidth-next_width;separator.next().css("flex-basis",next_width),separator.prev().css("flex-basis",prev_width)}})),$(window).resize((function(){$("div.preview").css("display",""),$("div.editor").css("flex-basis",""),$("div.data-check").css("flex-basis",""),help_page_num=5,switchHelp()})),$("#show-help").on("click",(function(){$("#page-help").fadeIn("fast"),switchHelp()})),$("#page-help").on("click",(function(){switchHelp()})),$("div#show-preview").on("click",(function(){const showPreview=$("div#show-preview");$("div.preview").slideToggle(),showPreview.hasClass("active")?showPreview.removeClass("active"):showPreview.addClass("active")})),$("#open-about").on("click",(function(){$("div.page-about").removeClass("about-hide")})),$("#close-about-btn").on("click",(function(){$("div.page-about").addClass("about-hide")})),$("#hamburger-opener").on("click",(function(){$(".switch-element-body").toggleClass("open",$("#hamburger-opener").is(":checked"))})),$('input[name="editor-switch"]').on("click",(function(){let hide=[!0,!0,!0,!0];switch($('input[name="editor-switch"]:checked').val()){case"event":hide[1]=!1;break;case"permutations":hide[2]=!1;break;case"blockState":hide[3]=!1;break;case"main":default:hide[0]=!1}$("#editor-main").toggleClass("hide",hide[0]),$("#editor-event").toggleClass("hide",hide[1]),$("#editor-permutations").toggleClass("hide",hide[2]),$("#editor-blockState").toggleClass("hide",hide[3])})),$(document).on("click",".block-tab-children>input[type=radio]",event=>{const target=$(event.target),tabNumber=Number(target.next(".tab-number").text());target.closest(".block-tabPanel").find(".block-tab-container").removeClass("selected"),target.closest(".block-tabPanel").find(".block-tab-container").eq(tabNumber).addClass("selected")}),$(document).on("click",".add-block-tab-element",event=>{const target=$(event.target),tabpanel=target.closest(".block-tabPanel"),body=tabpanel.find(".block-tab-body"),children_len=body.children().length;body.append($("<label>").addClass(`${target.prop("class").replace(" add-block-tab-element","")} block-tab-children invisible-Control`).append($("<input>").attr({type:"radio",name:"permutations"}).prop("checked",0==children_len).addClass("permutations block-tab"),$("<div>").addClass("tab-number").text(children_len)));const tab_contents=tabpanel.find(".block-tab-contents");tab_contents.append($("#permutation-block-tab").contents().clone().toggleClass("selected",0==children_len))}),$(document).on("click",".remove-block-tab-element",event=>{const target=$(event.target),tabpanel=target.closest(".block-tabPanel");let child=tabpanel.find(".block-tab-body > .block-tab-children"),child_len=child.length;if(child_len<=0)return;let checked_index=0;for(let index=0;index<child_len;index++)if(child.eq(index).find("input[type=radio]").is(":checked")){checked_index=index;break}tabpanel.find(".block-tab-container").eq(checked_index).remove(),child.eq(checked_index).remove(),tabpanel.find(".block-tab-container:first-child").addClass("selected"),child=tabpanel.find(".block-tab-body > .block-tab-children"),child_len=child.length;for(let index=0;index<child_len;index++)child.eq(index).find("input[type=radio]").prop("checked",0==index),child.eq(index).find(".tab-number").text(index)}),$(document).on("click","input.element-control-switch",event=>{const target=$(event.target),element_body=target.closest(".element-control").prev(".editor-element-body");target.is(":checked")?element_body.append($("#value-elements-component").contents().filter(`.value-element.${target.attr("name")}`).clone()):element_body.contents().filter(`.value-element.${target.attr("name")}`).remove()}),$(document).on("click",".switchable-content select",event=>{const select_elem=$(event.target),switchable_element=select_elem.closest(".switchable-content").nextAll(".switchable-element");for(let index=0;index<switchable_element.length;index++)switchable_element.eq(index).toggleClass("hide",!switchable_element.eq(index).hasClass(select_elem.val()))}),$(document).on("click",".tab-children>input[type=radio]",event=>{const target=$(event.target),tabNumber=Number(target.next(".tab-number").text());target.closest(".tabpanel").children(".tab-contents").children(".tab-container").removeClass("selected").eq(tabNumber).addClass("selected")}),$(document).on("click",".add-tab-element",event=>{const target=$(event.target),tabpanel=target.closest(".tabpanel"),body=tabpanel.children(".tab-navigation").children(".tab-body"),child=body.children(":first-child").clone();child.find("input[type=radio]").prop("checked",!1),child.find(".tab-number").text(body.children().length),body.append(child);const tab_contents=tabpanel.children(".tab-contents");tab_contents.append(tab_contents.children("div:first-child").clone().removeClass("selected"))}),$(document).on("click",".remove-tab-element",event=>{const target=$(event.target),tabpanel=target.closest(".tabpanel");let child=tabpanel.children(".tab-navigation").find(".tab-body > .tab-children"),child_len=child.length;if(child_len<=1)return;let checked_index=0;for(let index=0;index<child_len;index++)if(child.eq(index).find("input[type=radio]").is(":checked")){checked_index=index;break}target.closest(".tabpanel").children(".tab-contents").children(".tab-container").eq(checked_index).remove(),child.eq(checked_index).remove(),target.closest(".tabpanel").children(".tab-contents").children(".tab-container:first-child").addClass("selected"),child=tabpanel.children(".tab-navigation").find(".tab-body > .tab-children"),child_len=child.length;for(let index=0;index<child_len;index++)child.eq(index).find("input[type=radio]").prop("checked",0==index),child.eq(index).find(".tab-number").text(index)}),$(document).on("click","input.add-array-element",event=>{const value_input=$(event.target).closest(".value-input"),array_list=value_input.find(".array-list"),class_name=array_list.find(".array-data:last-child>input").attr("name");value_input.hasClass("type-array-modal")?array_list.append($("<div>").addClass("array-data type-modal").append($("<label>").append($("<div>").addClass("array-num").text(array_list.children().length),$("<input>").attr({type:"button",value:"編集"}).addClass("modal-open")),array_list.find(":first-child .modal").clone())):array_list.append($("<label>").addClass("array-data").append($("<div>").addClass("array-num").text(array_list.children().length),(()=>{const input=$("<input>");if(value_input.hasClass("type-array-integer"))input.attr({type:"number",name:class_name}).addClass(`${class_name} type-array-integer`);else if(value_input.hasClass("type-array-string"))input.attr({type:"text",name:class_name}).addClass(`${class_name} type-array-string`);else if(value_input.hasClass("type-array-select"))return $("<select>").attr("name",class_name).addClass(`${class_name} type-array-select`).append($('<option value="up">上</option>'),$('<option value="down">下</option>'),$('<option value="north">北</option>'),$('<option value="south">南</option>'),$('<option value="east">東</option>'),$('<option value="west">西</option>'),$('<option value="side">側面</option>'),$('<option value="all">全面</option>'));return input})()))}),$(document).on("click","input.remove-array-element",event=>{const list=$(event.target).closest(".value-input").find(".array-list");list<=1||list.find(".array-data:last-child").remove()}),$(document).on("click",".modal-open",event=>{$(event.target).closest(".type-modal").children(".modal").removeClass("hide"),event.stopPropagation()}),$(document).on("click",".modal",event=>{const click_element=$(event.target);click_element.children(".modal-dialog").length&&click_element.closest(".type-modal").children(".modal").addClass("hide"),event.stopPropagation()}),$(document).on("click",".modal-close",event=>{const click_element=$(event.target);click_element.closest(".type-modal").children(".modal").addClass("hide")}),$("#issue-control").on("click",(function(){const control_bar_img=$("div.issue-status-label svg");control_bar_img.hasClass("close")?control_bar_img.attr("class","open"):control_bar_img.attr("class","close"),$("div.issue-content").slideToggle()})),$("#event-add").on("click",()=>{$(".event.status-block-body").append($("#event-status-block").contents().clone())}),$(document).on("click","input.event-delete",event=>{$(event.target).closest(".status-block-content").remove()}),$("#blockState-add").on("click",()=>{$(".blockState.status-block-body").append($("#blockState-status-block").contents().clone())}),$(document).on("click","input.blockState-delete",event=>{$(event.target).closest(".status-block-content").remove()}),$("#page-share").on("click",(function(){const data={title:"とかさんの Block Generator",text:"とかさんの Block Generator -block jsonを簡単に作成・編集-",url:"https://toka7290.github.io/TokaBlockGenerator/"};navigator.share&&navigator.share(data)})),$("#input-file").on("change",(function(){importJsonFile()})),$(document).on("dragenter dragover",(function(event){event.stopPropagation(),event.preventDefault(),$(".file-drop-zone").removeClass("hide")})),$(".file-drop-zone,.file-drop-zone-textarea").on("dragleave",(function(event){event.stopPropagation(),event.preventDefault(),$(".file-drop-zone").addClass("hide")})),$(document).on("drop",(function(_event){isChanged=!0,$(".file-drop-zone").addClass("hide");var event=_event;_event.originalEvent&&(event=_event.originalEvent),event.stopPropagation(),event.preventDefault(),$("#input-file").prop("files",event.dataTransfer.files),importJsonFile()})),$("#control-copy").on("click",(function(){const codeBuffer=$("textarea#code-buffer");codeBuffer.select(),document.execCommand("copy"),$("p#control-copy-text").text("Copied"),codeBuffer.blur(),setTimeout((function(){$("p#control-copy-text").text("Copy")}),1e3)})),$("#control-download").on("click",(function(){let content=$("textarea#code-buffer").val();$("<a></a>",{href:window.URL.createObjectURL(new Blob([content])),download:"manifest.json",target:"_blank"})[0].click()})),$(document).on("change",".components-map-color",event=>{$(event.target).closest(".type-color").find(".components-map-color-pick").val($(event.target).val())}),$(document).on("change",".components-map-color-pick",event=>{$(event.target).closest(".type-color").find(".components-map-color").val($(event.target).val())}),$(document).on("change",".components-block-light-emission",event=>{const target=$(event.target);target.next(".components-block-light-emission-eq").text(`= ${`  ${Math.round(15*parseFloat(target.val()))}`.slice(-2)}`)}),$("#format-version").on("change",(function(){format_version=$("#format-version").val(),Object.keys(format_json).length||setFormatJson();for(const format_key in format_json)$(`.${format_key}`).toggleClass("unsupported",!format_json[format_key].includes(format_version))})),$(window).on("load",()=>{setFormatJson()}),$.fn.closestOpposite=function(selector){var children=this.children();return 0===children.length?$():this.filter(selector).length?this.filter(selector):children.closestOpposite(selector)};